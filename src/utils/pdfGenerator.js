// src/utils/pdfGenerator.js (Improved)
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';

// --- 1. BRAND, FONT, THEME & LOGO DEFINITIONS ---

const BRAND = {
  name: 'CourseFinder',
  tagline: 'Your Gateway to Knowledge',
};

// [ACTION REQUIRED] This is where you will paste your logo's Base64 string.
const LOGO_BASE64 = 'data:image/jpeg;base64,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';

const FONTS = {
  title: 'PlayfairDisplay',
  body: 'Lato',
  bodyBold: 'Lato-Bold',
};

const THEME = {
  PRIMARY_COLOR: '#004D40', // Deep Teal
  ACCENT_COLOR: '#FFC107',  // Gold/Amber
  TEXT_COLOR: '#212121',     // Dark Gray (almost black)
  LIGHT_TEXT_COLOR: '#757575',// Medium Gray
  TABLE_HEADER_BG: '#004D40',// Deep Teal
  TABLE_HEADER_TEXT: '#FFFFFF',// White
  ROW_HIGHLIGHT_COLOR: '#E0F2F1', // Very light teal
  ALTERNATE_ROW_COLOR: '#FAFAFA',// Off-white
  LINE_COLOR: '#B2DFDB',     // Light Teal
};

/**
 * [ACTION REQUIRED]
 * Registers custom fonts with jsPDF. The Base64 strings are placeholders.
 * @param {jsPDF} doc The jsPDF instance.
 */
const registerCustomFonts = (doc) => {
  // --- PASTE YOUR BASE64 FONT STRINGS HERE ---
  const latoRegularBase64 = 'PASTE_YOUR_LATO_REGULAR_BASE64_STRING_HERE';
  const latoBoldBase64 = 'PASTE_YOUR_LATO_BOLD_BASE64_STRING_HERE';
  const playfairDisplayRegularBase64 = 'PASTE_YOUR_PLAYFAIR_DISPLAY_BASE64_STRING_HERE';

  if (latoRegularBase64.startsWith('PASTE_YOUR')) {
    console.warn("Custom fonts not configured. Using fallback Helvetica.");
    FONTS.title = 'helvetica';
    FONTS.body = 'helvetica';
    FONTS.bodyBold = 'helvetica';
  } else {
    doc.addFileToVFS('Lato-Regular.ttf', latoRegularBase64);
    doc.addFileToVFS('Lato-Bold.ttf', latoBoldBase64);
    doc.addFileToVFS('PlayfairDisplay-Regular.ttf', playfairDisplayRegularBase64);
    doc.addFont('Lato-Regular.ttf', FONTS.body, 'normal');
    doc.addFont('Lato-Bold.ttf', FONTS.bodyBold, 'normal');
    doc.addFont('PlayfairDisplay-Regular.ttf', FONTS.title, 'normal');
  }
};

/**
 * Draws the header for each page.
 * @param {jsPDF} doc - The jsPDF instance.
 * @param {object} data - The autoTable data object.
 */
const drawPageHeader = (doc, data) => {
  const { width: pageWidth } = doc.internal.pageSize;
  const kenyaDate = new Date().toLocaleDateString('en-KE', { timeZone: 'Africa/Nairobi' });
  
  if (data.pageNumber === 1) {
    // --- Main Header (First Page Only) ---

    // Draw your image logo
    if (!LOGO_BASE64.startsWith('PASTE_YOUR')) {
      // You can adjust the x, y, width, and height as needed
      // doc.addImage(imageData, format, x, y, width, height);
      doc.addImage(LOGO_BASE64, 'PNG', pageWidth - 40, 14, 25, 15);
    }

    doc.setFont(FONTS.title, 'normal');
    doc.setFontSize(26);
    doc.setTextColor(THEME.PRIMARY_COLOR);
    doc.text('Matched Course Results', 14, 22);

    doc.setFont(FONTS.body);
    doc.setFontSize(11);
    doc.setTextColor(THEME.LIGHT_TEXT_COLOR);
    doc.text(`Prepared for you by ${BRAND.name} on ${kenyaDate}`, 14, 30);

    doc.setDrawColor(THEME.ACCENT_COLOR);
    doc.setLineWidth(0.8);
    doc.line(14, 38, pageWidth - 14, 38); // Accent line
  } else {
    // --- Compact Header (Subsequent Pages) ---
    doc.setFont(FONTS.bodyBold);
    doc.setFontSize(10);
    doc.setTextColor(THEME.PRIMARY_COLOR);
    doc.text('Matched Course Results', 14, 22);
  }
};

/**
 * Draws the footer for each page.
 * @param {jsPDF} doc - The jsPDF instance.
 * @param {object} data - The autoTable data object.
 */
const drawPageFooter = (doc, data) => {
  const { width: pageWidth, height: pageHeight } = doc.internal.pageSize;
  const totalPages = doc.internal.getNumberOfPages();
  
  doc.setFont(FONTS.body);
  doc.setFontSize(9);
  doc.setTextColor(THEME.LIGHT_TEXT_COLOR);
  
  const footerText = `${BRAND.name} • Page ${data.pageNumber} of ${totalPages}`;
  doc.text(footerText, pageWidth / 2, pageHeight - 10, { align: 'center' });
};

/**
 * Generates a stylish, professionally formatted PDF of course results.
 * @param {Array<Object>} courses - The array of course data.
 */
export const generateCoursePDF = (courses) => {
  if (!courses || courses.length === 0) {
    console.warn('PDF generation was cancelled because no course data was provided.');
    return;
  }

  const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
  registerCustomFonts(doc);

  const head = [['Institution', 'Code', 'Cutoff Points']];
  const body = courses.flatMap(course => {
    const courseTitleRow = [{ content: course.course, colSpan: 3, isCourseTitle: true }];
    if (course.universities?.length > 0) {
      const universityRows = course.universities.map(uni => [uni.name, uni.course_code || 'N/A', uni.cutoff]);
      return [courseTitleRow, ...universityRows];
    }
    return [courseTitleRow, [{ content: 'No university information available.', colSpan: 3, styles: { fontStyle: 'italic', halign: 'center' }}]];
  });

  const dateISO = new Date().toISOString().split('T')[0];

  autoTable(doc, {
    startY: 45, // Start table below the header area
    head: head,
    body: body,
    theme: 'grid',
    styles: {
      font: FONTS.body,
      fontSize: 9,
      cellPadding: 2.5,
      textColor: THEME.TEXT_COLOR,
    },
    headStyles: {
      font: FONTS.bodyBold,
      fillColor: THEME.TABLE_HEADER_BG,
      textColor: THEME.TABLE_HEADER_TEXT,
      fontSize: 10,
      halign: 'center',
    },
    columnStyles: {
      2: { halign: 'center', cellWidth: 30 }
    },
    alternateRowStyles: {
      fillColor: THEME.ALTERNATE_ROW_COLOR,
    },
    didParseCell: (data) => {
      // Style the custom course title rows
      if (data.cell.raw.isCourseTitle) {
        data.cell.styles.fillColor = THEME.ROW_HIGHLIGHT_COLOR;
        data.cell.styles.textColor = THEME.PRIMARY_COLOR;
        data.cell.styles.font = FONTS.bodyBold;
        data.cell.styles.fontStyle = 'normal';
        data.cell.styles.fontSize = 11;
        data.cell.styles.valign = 'middle';
      }
    },
    didDrawPage: (data) => {
      drawPageHeader(doc, data);
      drawPageFooter(doc, data);
    }
  });

  doc.save(`${BRAND.name}_Results_${dateISO}.pdf`);
};
